<!DOCTYPE html>
<html lang="de">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Topografie-Trainer</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Leaflet CSS -->
    <link
      rel="stylesheet"
      href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
      integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY="
      crossorigin=""
    />

    <!-- Babel Standalone (für JSX im Browser) -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <style>
      :root {
        /* Dark Mode Glass Variables */
        --glass: rgba(30, 41, 59, 0.7);
        --glass-border: rgba(255, 255, 255, 0.1);
        --glass-heavy: rgba(15, 23, 42, 0.85);
        --primary: #3b82f6;
        --blur: 16px;
      }

      body {
        /* Deep Dark Mesh Gradient */
        background-color: #0f172a;
        background-image: 
          radial-gradient(at 0% 0%, hsla(253,16%,7%,1) 0, transparent 50%), 
          radial-gradient(at 50% 0%, hsla(225,39%,20%,1) 0, transparent 50%), 
          radial-gradient(at 100% 0%, hsla(339,49%,20%,1) 0, transparent 50%);
        background-attachment: fixed;
        background-size: cover;
        color: #e2e8f0;
        font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
        margin: 0;
        padding: 0;
        height: 100vh;
        overflow: hidden;
      }

      /* Glassmorphism Utilities */
      .glass-panel {
        background: var(--glass);
        backdrop-filter: blur(var(--blur));
        -webkit-backdrop-filter: blur(var(--blur));
        border: 1px solid var(--glass-border);
        box-shadow: 0 8px 32px 0 rgba(0, 0, 0, 0.3);
      }

      .glass-card {
        background: rgba(255, 255, 255, 0.05);
        backdrop-filter: blur(10px);
        -webkit-backdrop-filter: blur(10px);
        border: 1px solid rgba(255, 255, 255, 0.1);
        box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.2);
        color: white;
      }

      .glass-bar-dark {
        background: rgba(0, 0, 0, 0.6);
        backdrop-filter: blur(20px);
        -webkit-backdrop-filter: blur(20px);
        border: 1px solid rgba(255, 255, 255, 0.1);
        box-shadow: 0 8px 32px 0 rgba(0, 0, 0, 0.5);
        color: white;
      }

      /* Custom Leaflet Dark Popup */
      .leaflet-popup-content-wrapper, .leaflet-popup-tip {
        background: rgba(30, 41, 59, 0.95);
        backdrop-filter: blur(8px);
        color: #f1f5f9;
        border: 1px solid rgba(255,255,255,0.1);
        box-shadow: 0 4px 20px rgba(0,0,0,0.5);
      }
      .leaflet-container a.leaflet-popup-close-button {
        color: #94a3b8;
      }

      /* Leaflet Marker Animations */
      .leaflet-interactive {
        transition: stroke-width 0.2s ease;
        transform-box: fill-box;
        transform-origin: center;
        animation: markerBounce 0.4s cubic-bezier(0.34, 1.56, 0.64, 1);
      }
      .leaflet-interactive:hover {
        stroke-width: 4px;
      }

      /* Animations Keyframes */
      @keyframes fadeInUp {
        from { opacity: 0; transform: translateY(12px); }
        to { opacity: 1; transform: translateY(0); }
      }
      @keyframes slideDown {
        from { opacity: 0; transform: translateY(-20px); }
        to { opacity: 1; transform: translateY(0); }
      }
      @keyframes popIn {
        from { opacity: 0; transform: scale(0.95); }
        to { opacity: 1; transform: scale(1); }
      }
      @keyframes pulse-custom {
        0% { transform: scale(1); filter: brightness(1); }
        50% { transform: scale(1.1); filter: brightness(1.3); }
        100% { transform: scale(1); filter: brightness(1); }
      }
      @keyframes markerBounce {
        0% { transform: scale(0); opacity: 0; }
        60% { transform: scale(1.2); opacity: 1; }
        100% { transform: scale(1); }
      }

      /* Animation Utility Classes */
      .animate-fade-in-up { animation: fadeInUp 0.45s cubic-bezier(0.4, 0, 0.2, 1) forwards; }
      .animate-slide-down { animation: slideDown 0.4s cubic-bezier(0.2, 0.8, 0.2, 1) forwards; }
      .animate-pop-in { animation: popIn 0.35s cubic-bezier(0.34, 1.56, 0.64, 1) forwards; }
      .animate-pulse-once { animation: pulse-custom 0.3s ease-out forwards; }
      .animate-marker-bounce { animation: markerBounce 0.5s cubic-bezier(0.34, 1.56, 0.64, 1) forwards; }
      
      .delay-100 { animation-delay: 100ms; }
      .delay-200 { animation-delay: 200ms; }
      .delay-300 { animation-delay: 300ms; }

      /* Scrollbars */
      ::-webkit-scrollbar { width: 8px; height: 8px; }
      ::-webkit-scrollbar-track { background: rgba(15, 23, 42, 0.5); }
      ::-webkit-scrollbar-thumb { background: rgba(71, 85, 105, 0.8); border-radius: 4px; }
      ::-webkit-scrollbar-thumb:hover { background: rgba(100, 116, 139, 1); }

      /* Fix Leaflet Z-Index */
      .leaflet-control-container .leaflet-top,
      .leaflet-control-container .leaflet-bottom { z-index: 400; }
    </style>

    <!-- Import Map for Modules (using public CDNs) -->
    <script type="importmap">
{
  "imports": {
    "react": "https://esm.sh/react@18.2.0",
    "react-dom/client": "https://esm.sh/react-dom@18.2.0/client",
    "leaflet": "https://unpkg.com/leaflet@1.9.4/dist/leaflet-src.esm.js",
    "react-leaflet": "https://esm.sh/react-leaflet@4.2.1?external=react,react-dom,leaflet",
    "lucide-react": "https://esm.sh/lucide-react@0.292.0?external=react",
    "react-dom/": "https://aistudiocdn.com/react-dom@^19.2.0/",
    "react/": "https://aistudiocdn.com/react@^19.2.0/"
  }
}
</script>
  </head>
  <body>
    <div id="root"></div>

    <!-- MAIN APP SCRIPT -->
    <script type="text/babel" data-type="module" data-presets="typescript,react">
      import React, { useState, useEffect, useRef } from 'react';
      import { createRoot } from 'react-dom/client';
      import { MapContainer, TileLayer, Popup, useMapEvents, Polyline, CircleMarker } from 'react-leaflet';
      import { Download, Upload, MapPin, Trash2, Edit2, Check, X, Plus, Play, RotateCcw, Trophy, XCircle, Navigation, Map as MapIcon } from 'lucide-react';
      import L from 'leaflet';

      // Fix Leaflet Icons in standalone mode
      delete L.Icon.Default.prototype._getIconUrl;
      L.Icon.Default.mergeOptions({
        iconRetinaUrl: 'https://unpkg.com/leaflet@1.9.4/dist/images/marker-icon-2x.png',
        iconUrl: 'https://unpkg.com/leaflet@1.9.4/dist/images/marker-icon.png',
        shadowUrl: 'https://unpkg.com/leaflet@1.9.4/dist/images/marker-shadow.png',
      });

      // --- TYPES ---
      const LocationCategory = {
        CITY: 'Stadt',
        COUNTRY: 'Land',
        RIVER: 'Fluss',
        LAKE: 'See',
        MOUNTAIN: 'Gebirge',
        SEA: 'Meer',
        OTHER: 'Sonstiges',
      };

      const DEFAULT_LOCATIONS = [
        { id: '1', name: 'Berlin', category: LocationCategory.CITY, lat: 52.52, lng: 13.405 },
        { id: '2', name: 'Paris', category: LocationCategory.CITY, lat: 48.8566, lng: 2.3522 },
        { id: '3', name: 'Rom', category: LocationCategory.CITY, lat: 41.9028, lng: 12.4964 },
        { id: '4', name: 'London', category: LocationCategory.CITY, lat: 51.5074, lng: -0.1278 },
        { id: '5', name: 'Madrid', category: LocationCategory.CITY, lat: 40.4168, lng: -3.7038 },
        { id: '6', name: 'Zugspitze', category: LocationCategory.MOUNTAIN, lat: 47.421, lng: 10.985 },
        { id: '7', name: 'Bodensee', category: LocationCategory.LAKE, lat: 47.636, lng: 9.389 },
      ];

      // --- UTILS ---
      const calculateDistance = (lat1, lon1, lat2, lon2) => {
        const R = 6371;
        const dLat = (lat2 - lat1) * (Math.PI / 180);
        const dLon = (lon2 - lon1) * (Math.PI / 180);
        const a =
          Math.sin(dLat / 2) * Math.sin(dLat / 2) +
          Math.cos(lat1 * (Math.PI / 180)) * Math.cos(lat2 * (Math.PI / 180)) *
          Math.sin(dLon / 2) * Math.sin(dLon / 2);
        const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1 - a));
        return Math.round(R * c * 100) / 100;
      };

      // --- COMPONENTS ---

      // BUTTON
      const Button = ({ children, variant = 'primary', size = 'md', className = '', fullWidth = false, ...props }) => {
        const baseStyles = "inline-flex items-center justify-center font-medium transition-all duration-200 active:scale-95 disabled:opacity-50 disabled:pointer-events-none rounded-xl shadow-sm will-change-transform";
        const variants = {
          primary: "bg-blue-600 text-white hover:bg-blue-500 shadow-lg shadow-blue-500/20 hover:shadow-blue-500/50 hover:scale-[1.02]",
          secondary: "bg-slate-700 text-slate-200 border border-slate-600 hover:bg-slate-600 hover:border-slate-500 hover:shadow-lg hover:shadow-black/20 hover:scale-[1.02]",
          success: "bg-green-600 text-white hover:bg-green-500 shadow-lg shadow-green-500/30 hover:scale-[1.02]",
          glass: "bg-white/10 hover:bg-white/20 text-white border border-white/10 backdrop-blur-md shadow-none hover:shadow-lg hover:shadow-white/10 hover:scale-[1.05]"
        };
        const sizes = { sm: "h-9 px-3 text-sm", md: "h-11 px-5 text-sm", lg: "h-14 px-8 text-lg" };
        
        return (
          <button className={`${baseStyles} ${variants[variant]} ${sizes[size]} ${fullWidth ? "w-full" : ""} ${className}`} {...props}>
            {children}
          </button>
        );
      };

      // LOCATION MANAGER
      const LocationManager = ({ locations, onAddLocation, onUpdateLocation, onDeleteLocation, onImportLocations, onEnablePickMode, pickedCoordinates, isPickModeActive }) => {
        const [name, setName] = useState('');
        const [category, setCategory] = useState(LocationCategory.CITY);
        const [lat, setLat] = useState('');
        const [lng, setLng] = useState('');
        const [editingId, setEditingId] = useState(null);
        const fileInputRef = useRef(null);

        useEffect(() => {
          if (pickedCoordinates) {
            setLat(pickedCoordinates.lat.toFixed(6));
            setLng(pickedCoordinates.lng.toFixed(6));
          }
        }, [pickedCoordinates]);

        const handleSubmit = (e) => {
          e.preventDefault();
          if (!name || !lat || !lng) return;
          const newLocation = { id: editingId || crypto.randomUUID(), name, category, lat: parseFloat(lat), lng: parseFloat(lng) };
          editingId ? onUpdateLocation(newLocation) : onAddLocation(newLocation);
          setName(''); setLat(''); setLng(''); setCategory(LocationCategory.CITY); setEditingId(null);
        };

        const handleEdit = (loc) => {
          setEditingId(loc.id); setName(loc.name); setCategory(loc.category); setLat(loc.lat); setLng(loc.lng);
        };

        const handleExport = () => {
          const dataStr = "data:text/json;charset=utf-8," + encodeURIComponent(JSON.stringify(locations, null, 2));
          const a = document.createElement('a'); a.href = dataStr; a.download = "topografie_daten.json"; a.click();
        };

        const handleImport = (e) => {
          const file = e.target.files?.[0];
          if (!file) return;
          const reader = new FileReader();
          reader.onload = (ev) => {
            try { onImportLocations(JSON.parse(ev.target.result)); } catch (err) { alert('Fehler beim Import'); }
          };
          reader.readAsText(file);
        };

        const inputClass = "block w-full rounded-xl border-none bg-slate-900/50 px-4 py-2.5 text-sm text-slate-100 shadow-sm ring-1 ring-white/10 placeholder:text-slate-500 focus:ring-2 focus:ring-blue-500 focus:bg-slate-900/80 transition-all outline-none";

        return (
          <div className="flex flex-col h-full glass-panel rounded-3xl overflow-hidden shadow-2xl animate-fade-in-up">
            <div className="p-6 border-b border-white/10 bg-white/5 backdrop-blur-md relative z-10">
              <h2 className="text-lg font-bold text-slate-100 mb-4 flex items-center">
                <Edit2 className="w-4 h-4 mr-2 text-blue-400" /> {editingId ? 'Ort bearbeiten' : 'Neuer Ort'}
              </h2>
              <form onSubmit={handleSubmit} className="space-y-4">
                <input type="text" value={name} onChange={e => setName(e.target.value)} className={inputClass} placeholder="Name" required />
                <select value={category} onChange={e => setCategory(e.target.value)} className={inputClass}>
                  {Object.values(LocationCategory).map(cat => <option key={cat} value={cat} className="bg-slate-800">{cat}</option>)}
                </select>
                <div className="grid grid-cols-2 gap-3">
                  <input type="number" step="any" value={lat} onChange={e => setLat(e.target.value)} className={inputClass} placeholder="Lat" required />
                  <input type="number" step="any" value={lng} onChange={e => setLng(e.target.value)} className={inputClass} placeholder="Lng" required />
                </div>
                <div className="flex gap-2">
                  <Button type="button" variant={isPickModeActive ? "success" : "secondary"} size="sm" onClick={onEnablePickMode} className="flex-1">
                    <MapPin className="w-4 h-4 mr-1.5" /> {isPickModeActive ? 'Wähle...' : 'Karte'}
                  </Button>
                  <Button type="submit" size="sm" className="flex-[2]">{editingId ? 'Speichern' : 'Hinzufügen'}</Button>
                  {editingId && <Button type="button" variant="secondary" size="sm" onClick={() => setEditingId(null)}><X className="w-4 h-4" /></Button>}
                </div>
              </form>
            </div>
            <div className="flex-1 overflow-auto p-4 bg-black/10">
               {locations.length === 0 ? <div className="text-center p-8 text-slate-400">Keine Orte.</div> : (
                 <div className="space-y-3">
                   {locations.map((loc, idx) => (
                     <div key={loc.id} className="group glass-card rounded-xl p-3 flex justify-between animate-pop-in hover:bg-white/10" style={{animationDelay: `${Math.min(idx*50,500)}ms`}}>
                       <div>
                         <div className="font-semibold text-slate-200 text-sm">{loc.name}</div>
                         <div className="text-[10px] text-blue-300">{loc.category}</div>
                       </div>
                       <div className="flex gap-1 opacity-60 group-hover:opacity-100">
                         <button onClick={() => handleEdit(loc)} className="p-1.5 hover:text-blue-400"><Edit2 className="w-4 h-4" /></button>
                         <button onClick={() => onDeleteLocation(loc.id)} className="p-1.5 hover:text-red-400"><Trash2 className="w-4 h-4" /></button>
                       </div>
                     </div>
                   ))}
                 </div>
               )}
            </div>
            <div className="p-4 border-t border-white/10 bg-white/5 flex gap-2">
              <Button variant="secondary" size="sm" className="flex-1" onClick={handleExport}><Download className="w-3 h-3 mr-1" /> Export</Button>
              <Button variant="secondary" size="sm" className="flex-1" onClick={() => fileInputRef.current?.click()}><Upload className="w-3 h-3 mr-1" /> Import</Button>
              <input type="file" ref={fileInputRef} className="hidden" accept=".json" onChange={handleImport} />
            </div>
          </div>
        );
      };

      // MAP QUIZ
      const MapEvents = ({ onMapClick }) => {
        useMapEvents({ click(e) { onMapClick({ lat: e.latlng.lat, lng: e.latlng.lng }); } });
        return null;
      };

      const MapQuiz = ({ locations, isPickMode, onPickCoordinate, onQuizStatusChange }) => {
        const [filterCategory, setFilterCategory] = useState('Alle');
        const [quizState, setQuizState] = useState({ isActive: false, questions: [], currentQuestionIndex: 0, score: 0, showResult: false, lastGuessDistance: null, lastGuessCoords: null, isFinished: false });

        useEffect(() => { onQuizStatusChange(quizState.isActive); }, [quizState.isActive]);

        const currentQuestion = quizState.isActive && !quizState.isFinished ? quizState.questions[quizState.currentQuestionIndex] : null;

        const handleStartQuiz = () => {
          if (locations.length === 0) return alert("Bitte lege zuerst Orte an.");
          const filtered = filterCategory === 'Alle' ? locations : locations.filter(l => l.category === filterCategory);
          if (filtered.length === 0) return alert("Keine Orte in dieser Kategorie.");
          setQuizState({ isActive: true, questions: [...filtered].sort(() => Math.random() - 0.5), currentQuestionIndex: 0, score: 0, showResult: false, lastGuessDistance: null, lastGuessCoords: null, isFinished: false });
        };

        const handleMapClick = (coords) => {
          if (isPickMode) {
            onPickCoordinate(coords.lat, coords.lng);
          } else if (quizState.isActive && !quizState.showResult && !quizState.isFinished) {
            const dist = calculateDistance(currentQuestion.lat, currentQuestion.lng, coords.lat, coords.lng);
            setQuizState(prev => ({ ...prev, score: dist <= 50 ? prev.score + 1 : prev.score, showResult: true, lastGuessDistance: dist, lastGuessCoords: coords }));
          }
        };

        const nextQuestion = () => {
          if (quizState.currentQuestionIndex >= quizState.questions.length - 1) {
            setQuizState(prev => ({ ...prev, isFinished: true, showResult: false }));
          } else {
            setQuizState(prev => ({ ...prev, currentQuestionIndex: prev.currentQuestionIndex + 1, showResult: false, lastGuessDistance: null, lastGuessCoords: null }));
          }
        };

        const resetQuiz = () => {
          setQuizState({ isActive: false, questions: [], currentQuestionIndex: 0, score: 0, showResult: false, lastGuessDistance: null, lastGuessCoords: null, isFinished: false });
        };

        const isCorrect = quizState.lastGuessDistance !== null && quizState.lastGuessDistance <= 50;

        return (
          <div className="h-full relative flex flex-col w-full">
            {quizState.isActive && !quizState.isFinished && (
              <div className="absolute top-0 left-0 right-0 p-6 z-[500] pointer-events-none flex justify-center">
                <div className="glass-bar-dark rounded-2xl px-8 py-4 flex items-center gap-8 shadow-2xl pointer-events-auto animate-slide-down">
                  <div className="flex flex-col items-center border-r border-white/10 pr-6">
                    <span className="text-[10px] uppercase text-slate-400 font-bold">Score</span>
                    <span key={quizState.score} className="text-2xl font-bold text-blue-400 animate-pulse-once">{quizState.score}</span>
                  </div>
                  <div className="text-center">
                    <div className="text-xs text-slate-400 mb-1">Finde:</div>
                    <div key={currentQuestion?.id} className="text-3xl font-bold text-white flex items-center justify-center gap-3 animate-fade-in-up">
                      <MapPin className="text-red-400 animate-pulse" /> {currentQuestion?.name}
                    </div>
                  </div>
                  <div className="pl-6 border-l border-white/10">
                    <Button onClick={resetQuiz} variant="glass" size="sm" className="rounded-full w-10 h-10 p-0"><XCircle /></Button>
                  </div>
                </div>
              </div>
            )}

            {!quizState.isActive && (
              <div className="absolute top-4 left-4 right-4 z-[400] flex justify-between items-start pointer-events-none">
                <div className="glass-card rounded-2xl p-2 pointer-events-auto flex items-center gap-2 bg-slate-900/80 animate-fade-in-up">
                  <select className="bg-transparent text-sm font-semibold text-white outline-none px-2" value={filterCategory} onChange={e => setFilterCategory(e.target.value)}>
                    <option className="text-black" value="Alle">Alle Kategorien</option>
                    {Object.values(LocationCategory).map(c => <option className="text-black" key={c} value={c}>{c}</option>)}
                  </select>
                  <Button onClick={handleStartQuiz} variant="primary" className="rounded-xl"><Play className="w-4 h-4 mr-2" /> Start</Button>
                </div>
              </div>
            )}

            <div className="flex-1 w-full h-full relative z-0">
              <MapContainer center={[51.1657, 10.4515]} zoom={6} style={{ height: '100%', width: '100%', background: '#aad3df' }} zoomControl={false}>
                <TileLayer attribution='&copy; OSM contributors' url="https://tile.openstreetmap.de/{z}/{x}/{y}.png" />
                <MapEvents onMapClick={handleMapClick} />
                {!quizState.isActive && locations.map(loc => (
                  <CircleMarker key={loc.id} center={[loc.lat, loc.lng]} pathOptions={{ color: '#1e293b', fillColor: '#3b82f6', fillOpacity: 0.8 }} radius={8}>
                    <Popup className="glass-popup"><strong className="text-lg">{loc.name}</strong><br/>{loc.category}</Popup>
                  </CircleMarker>
                ))}
                {quizState.isActive && quizState.showResult && (
                  <>
                    <CircleMarker center={[currentQuestion.lat, currentQuestion.lng]} pathOptions={{ color: '#fff', fillColor: '#22c55e', fillOpacity: 1 }} radius={10} />
                    <CircleMarker center={[quizState.lastGuessCoords.lat, quizState.lastGuessCoords.lng]} pathOptions={{ color: '#fff', fillColor: isCorrect ? '#22c55e' : '#ef4444', fillOpacity: 1 }} radius={10} />
                    <Polyline positions={[[currentQuestion.lat, currentQuestion.lng], [quizState.lastGuessCoords.lat, quizState.lastGuessCoords.lng]]} pathOptions={{ color: '#334155', dashArray: '10, 10' }} />
                  </>
                )}
              </MapContainer>

              {quizState.isActive && quizState.showResult && (
                <div className="absolute bottom-12 left-1/2 transform -translate-x-1/2 z-[1000] w-full max-w-sm px-4">
                  <div className="glass-panel bg-slate-900/90 rounded-3xl p-6 shadow-2xl text-center animate-pop-in">
                    <div className={`inline-flex items-center justify-center w-16 h-16 rounded-full mb-4 ${isCorrect ? 'bg-green-500/20 text-green-400' : 'bg-red-500/20 text-red-400'} animate-marker-bounce`}>
                      {isCorrect ? <Trophy size={32} /> : <Navigation size={32} />}
                    </div>
                    <h4 className={`text-2xl font-bold mb-1 ${isCorrect ? 'text-green-400' : 'text-red-400'}`}>{isCorrect ? 'Super!' : 'Daneben!'}</h4>
                    <p className="text-3xl font-black text-white mb-6">{quizState.lastGuessDistance} <span className="text-lg font-normal text-slate-500">km</span></p>
                    <Button onClick={nextQuestion} fullWidth>Weiter</Button>
                  </div>
                </div>
              )}

              {quizState.isFinished && (
                <div className="absolute inset-0 bg-slate-950/80 backdrop-blur-md z-[1000] flex items-center justify-center p-4">
                  <div className="glass-panel bg-slate-900 rounded-3xl p-10 text-center animate-pop-in max-w-md w-full">
                    <Trophy className="w-16 h-16 text-yellow-400 mx-auto mb-4 animate-marker-bounce" />
                    <h2 className="text-3xl font-bold text-white mb-2">Quiz beendet!</h2>
                    <p className="text-xl text-blue-400 font-bold mb-6">{quizState.score} / {quizState.questions.length} Richtig</p>
                    <div className="space-y-3">
                      <Button onClick={handleStartQuiz} variant="primary" fullWidth>Nochmal</Button>
                      <Button onClick={resetQuiz} variant="secondary" fullWidth>Beenden</Button>
                    </div>
                  </div>
                </div>
              )}
            </div>
          </div>
        );
      };

      // APP
      const App = () => {
        const [locations, setLocations] = useState([]);
        const [isPickMode, setIsPickMode] = useState(false);
        const [pickedCoordinates, setPickedCoordinates] = useState(null);
        const [isQuizActive, setIsQuizActive] = useState(false);

        useEffect(() => {
          const saved = localStorage.getItem('topografie_trainer_v1');
          setLocations(saved ? JSON.parse(saved) : DEFAULT_LOCATIONS);
        }, []);

        useEffect(() => { localStorage.setItem('topografie_trainer_v1', JSON.stringify(locations)); }, [locations]);

        return (
          <div className="flex flex-col h-screen overflow-hidden text-slate-200">
            <header className={`glass-panel z-50 transition-all duration-700 ${isQuizActive ? '-mt-24 opacity-0 absolute' : 'mt-4 mx-4 mb-4 relative'} px-6 py-4 flex items-center justify-center shrink-0 rounded-2xl`}>
              <div className="flex items-center gap-3">
                <div className="p-2 bg-blue-600 rounded-xl shadow-lg animate-marker-bounce"><MapIcon className="text-white" /></div>
                <div><h1 className="text-xl font-bold text-white">Topografie-Trainer</h1></div>
              </div>
            </header>
            <main className="flex-1 flex flex-col md:flex-row overflow-hidden gap-4 px-4 pb-4 relative">
              <div className={`transition-all duration-700 ease-[cubic-bezier(0.25,0.8,0.25,1)] ${isQuizActive ? 'w-0 opacity-0 -translate-x-full absolute' : 'w-full md:w-1/3 lg:w-[350px] relative'} flex flex-col h-full`}>
                <LocationManager locations={locations} onAddLocation={l => setLocations(p => [...p, l])} onUpdateLocation={l => setLocations(p => p.map(x => x.id === l.id ? l : x))} onDeleteLocation={id => setLocations(p => p.filter(x => x.id !== id))} onImportLocations={ls => setLocations(p => [...p, ...ls])} onEnablePickMode={() => setIsPickMode(true)} pickedCoordinates={pickedCoordinates} isPickModeActive={isPickMode} />
              </div>
              <div className={`transition-all duration-700 ease-[cubic-bezier(0.25,0.8,0.25,1)] ${isQuizActive ? 'fixed inset-0 z-[100] w-full h-full rounded-none' : 'w-full flex-1 rounded-3xl overflow-hidden glass-panel'}`}>
                <MapQuiz locations={locations} isPickMode={isPickMode} onPickCoordinate={(lat, lng) => { setPickedCoordinates({ lat, lng }); setIsPickMode(false); }} onQuizStatusChange={setIsQuizActive} />
              </div>
            </main>
          </div>
        );
      };

      const root = createRoot(document.getElementById('root'));
      root.render(<App />);
    </script>
  </body>
</html>